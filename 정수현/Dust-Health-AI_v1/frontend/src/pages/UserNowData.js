import React, { useState } from 'react';
import axios from 'axios';
//import '../css/usernowdata.css';

const UserNowData = () => {
    const [city, setCity] = useState('');
    const [region, setRegion] = useState('');
    const [todayDust, setTodayDust] = useState(null);
    const [errorMessage, setErrorMessage] = useState('');

    const cityRegionMap = {
        ì„œìš¸: [ 'ê°•ë‚¨êµ¬', 'ê°•ë™êµ¬',   'ê°•ë¶êµ¬',
                'ê°•ì„œêµ¬', 'ê´€ì•…êµ¬',   'ê´‘ì§„êµ¬',
                'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬',   'ë…¸ì›êµ¬',
                'ë„ë´‰êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ë™ì‘êµ¬',
                'ë§ˆí¬êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ì„œì´ˆêµ¬',
                'ì„±ë™êµ¬', 'ì„±ë¶êµ¬',   'ì†¡íŒŒêµ¬',
                'ì–‘ì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ìš©ì‚°êµ¬',
                'ì€í‰êµ¬', 'ì¢…ë¡œêµ¬',   'ì¤‘êµ¬',
                'ì¤‘ë‘êµ¬'
        ],
        ë¶€ì‚°: [ 'ê°•ì„œêµ¬',   'ê¸ˆì •êµ¬',
                'ê¸°ì¥êµ°',   'ë‚¨êµ¬',
                'ë™êµ¬',     'ë™ë˜êµ¬',
                'ë¶€ì‚°ì§„êµ¬', 'ë¶êµ¬',
                'ì‚¬ìƒêµ¬',   'ì‚¬í•˜êµ¬',
                'ì„œêµ¬',     'ìˆ˜ì˜êµ¬',
                'ì—°ì œêµ¬',   'ì˜ë„êµ¬',
                'ì¤‘êµ¬',     'í•´ìš´ëŒ€êµ¬'
        ],
        ëŒ€êµ¬: [  'ë‚¨êµ¬',   'ë‹¬ì„œêµ¬',
                'ë‹¬ì„±êµ°', 'ë™êµ¬',
                'ë¶êµ¬',   'ì„œêµ¬',
                'ìˆ˜ì„±êµ¬', 'ì¤‘êµ¬',
                'êµ°ìœ„êµ°'
        ],
        ì¸ì²œ: [ 'ê°•í™”êµ°',   'ê³„ì–‘êµ¬',
                'ë¯¸ì¶”í™€êµ¬', 'ë‚¨ë™êµ¬',
                'ë™êµ¬',     'ë¶€í‰êµ¬',
                'ì„œêµ¬',     'ì—°ìˆ˜êµ¬',
                'ì˜¹ì§„êµ°',   'ì¤‘êµ¬'
        ],
        ê´‘ì£¼: [ 'ê´‘ì‚°êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ì„œêµ¬'],
        ëŒ€ì „: [ 'ëŒ€ë•êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ì¤‘êµ¬'],
        ìš¸ì‚°: [ 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°', 'ì¤‘êµ¬' ],
        ì„¸ì¢…: [ 'ì„¸ì¢…ì‹œ'],
        ê²½ê¸°: [  'ê°€í‰êµ°',   'ê³ ì–‘ì‹œ', 'ê³¼ì²œì‹œ',
                'ê´‘ëª…ì‹œ',   'ê´‘ì£¼ì‹œ', 'êµ¬ë¦¬ì‹œ',
                'êµ°í¬ì‹œ',   'ê¹€í¬ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ',
                'ë™ë‘ì²œì‹œ', 'ë¶€ì²œì‹œ', 'ì„±ë‚¨ì‹œ',
                'ìˆ˜ì›ì‹œ',   'ì‹œí¥ì‹œ', 'ì•ˆì‚°ì‹œ',
                'ì•ˆì„±ì‹œ',   'ì•ˆì–‘ì‹œ', 'ì–‘ì£¼ì‹œ',
                'ì–‘í‰êµ°',   'ì—¬ì£¼ì‹œ', 'ì—°ì²œêµ°',
                'ì˜¤ì‚°ì‹œ',   'ìš©ì¸ì‹œ', 'ì˜ì™•ì‹œ',
                'ì˜ì •ë¶€ì‹œ', 'ì´ì²œì‹œ', 'íŒŒì£¼ì‹œ',
                'í‰íƒì‹œ',   'í¬ì²œì‹œ', 'í•˜ë‚¨ì‹œ',
                'í™”ì„±ì‹œ'
        ],
        ê°•ì›: [ 'ê°•ë¦‰ì‹œ', 'ê³ ì„±êµ°', 'ë™í•´ì‹œ',
                'ì‚¼ì²™ì‹œ', 'ì†ì´ˆì‹œ', 'ì–‘êµ¬êµ°',
                'ì–‘ì–‘êµ°', 'ì˜ì›”êµ°', 'ì›ì£¼ì‹œ',
                'ì¸ì œêµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°',
                'ì¶˜ì²œì‹œ', 'íƒœë°±ì‹œ', 'í‰ì°½êµ°',
                'í™ì²œêµ°', 'í™”ì²œêµ°', 'íš¡ì„±êµ°'
        ],
        ì¶©ë¶: [ 'ê´´ì‚°êµ°', 'ë‹¨ì–‘êµ°',
                'ë³´ì€êµ°', 'ì˜ë™êµ°',
                'ì˜¥ì²œêµ°', 'ìŒì„±êµ°',
                'ì œì²œì‹œ', 'ì§„ì²œêµ°',
                'ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ',
                'ì¦í‰êµ°'
        ],
        ì¶©ë‚¨: [ 'ê³µì£¼ì‹œ', 'ê¸ˆì‚°êµ°',
                'ë…¼ì‚°ì‹œ', 'ë‹¹ì§„ì‹œ',
                'ë³´ë ¹ì‹œ', 'ë¶€ì—¬êµ°',
                'ì„œì‚°ì‹œ', 'ì„œì²œêµ°',
                'ì•„ì‚°ì‹œ', 'ì˜ˆì‚°êµ°',
                'ì²œì•ˆì‹œ', 'ì²­ì–‘êµ°',
                'íƒœì•ˆêµ°', 'í™ì„±êµ°',
                'ê³„ë£¡ì‹œ'
        ],
        ì „ë¶: [ 'ê³ ì°½êµ°', 'êµ°ì‚°ì‹œ',
                'ê¹€ì œì‹œ', 'ë‚¨ì›ì‹œ',
                'ë¬´ì£¼êµ°', 'ë¶€ì•ˆêµ°',
                'ìˆœì°½êµ°', 'ì™„ì£¼êµ°',
                'ìµì‚°ì‹œ', 'ì„ì‹¤êµ°',
                'ì¥ìˆ˜êµ°', 'ì „ì£¼ì‹œ',
                'ì •ìì‹œ', 'ì§„ì•ˆêµ°'
        ],
        ì „ë‚¨: [ 'ê°•ì§„êµ°', 'ê³ í¥êµ°', 'ê³¡ì„±êµ°',
                'ê´‘ì–‘ì‹œ', 'êµ¬ë¡€êµ°', 'ë‚˜ì£¼ì‹œ',
                'ë‹´ì–‘êµ°', 'ëª©í¬ì‹œ', 'ë¬´ì•ˆêµ°',
                'ë³´ì„±êµ°', 'ìˆœì²œì‹œ', 'ì‹ ì•ˆêµ°',
                'ì—¬ìˆ˜ì‹œ', 'ì˜ê´‘êµ°', 'ì˜ì•”êµ°',
                'ì™„ë„êµ°', 'ì¥ì„±êµ°', 'ì¥í¥êµ°',
                'ì§„ë„êµ°', 'í•¨í‰êµ°', 'í•´ë‚¨êµ°',
                'í™”ìˆœêµ°'
        ],
        ê²½ë¶: [ 'ê²½ì‚°ì‹œ', 'ê²½ì£¼ì‹œ', 'êµ¬ë¯¸ì‹œ',
                'ê¹€ì²œì‹œ', 'ë¬¸ê²½ì‹œ', 'ë´‰í™”êµ°',
                'ìƒì£¼ì‹œ', 'ì„±ì£¼êµ°', 'ì•ˆë™ì‹œ',
                'ì˜ë•êµ°', 'ì˜ì–‘êµ°', 'ì˜ì£¼ì‹œ',
                'ì˜ì²œì‹œ', 'ì˜ˆì²œêµ°', 'ìš¸ë¦‰êµ°',
                'ìš¸ì§„êµ°', 'ì˜ì„±êµ°', 'ì²­ë„êµ°',
                'ì²­ì†¡êµ°', 'ì¹ ê³¡êµ°', 'í¬í•­ì‹œ'
        ],
        ê²½ë‚¨: [ 'ê±°ì œì‹œ', 'ê±°ì°½êµ°', 'ê³ ì„±êµ°',
                'ê¹€í•´ì‹œ', 'ë‚¨í•´êµ°', 'ë°€ì–‘ì‹œ',
                'ì‚¬ì²œì‹œ', 'ì‚°ì²­êµ°', 'ì–‘ì‚°ì‹œ',
                'ì˜ë ¹êµ°', 'ì§„ì£¼ì‹œ', 'ì°½ë…•êµ°',
                'ì°½ì›ì‹œ', 'í†µì˜ì‹œ', 'í•˜ë™êµ°',
                'í•¨ì•ˆêµ°', 'í•¨ì–‘êµ°', 'í•©ì²œêµ°'
        ],
        ì œì£¼: [ 'ì„œê·€í¬ì‹œ', 'ì œì£¼ì‹œ'],
    };

    const fetchUserNowData = async () => {
        if (!city || !region) {
            setErrorMessage('ì‹œ/ë„ì™€ êµ¬/êµ°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            const response = await axios.get(
                'http://apis.data.go.kr/B552584/ArpltnStatsSvc/getCtprvnMesureSidoLIst',
                {
                    params: {
                        serviceKey: 'pVHLUl3UGVDmm+B0aUxMttCQnoCePxtWLb4WJKushUW6XjTX93l89IkU/dELSR6nZ318fR3efuSBb3gVpjAFFA==',
                        returnType: 'json',
                        numOfRows: 100,
                        pageNo: 1,
                        sidoName: city,
                        searchCondition: 'DAILY',
                    },
                }
            );
            const items = response.data?.response?.body?.items || [];
            const regionData = items.find((item) => item.cityName === region);

            if (regionData) {
                setTodayDust(regionData);
                setErrorMessage('');
            } else {
                setErrorMessage('í•´ë‹¹ ì§€ì—­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        } catch (error) {
            console.error('ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜:', error);
            setErrorMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    };

    return (
        <div className="dustdata-container">
            <div className="form-container">
                <label>ì‹œ/ë„ ì„ íƒ:</label>
                <select value={city} onChange={(e) => setCity(e.target.value)}>
                    <option value="">ì„ íƒ</option>
                    {Object.keys(cityRegionMap).map((city) => (
                        <option key={city} value={city}>
                            {city}
                        </option>
                    ))}
                </select>

                <label>êµ¬/êµ° ì„ íƒ:</label>
                <select value={region} onChange={(e) => setRegion(e.target.value)}>
                    <option value="">ì„ íƒ</option>
                    {cityRegionMap[city]?.map((region) => (
                        <option key={region} value={region}>
                            {region}
                        </option>
                    ))}
                </select>

                <button onClick={fetchUserNowData}>ì¡°íšŒ</button>
                {errorMessage && <p className="error-message">{errorMessage}</p>}
            </div>

            {todayDust && (
                <div className="dustdata-result">
                    <h2>{city} {region}ì˜ í˜„ì¬ ë¯¸ì„¸ë¨¼ì§€</h2>
                    <p>{new Date().toLocaleString()}</p>
                    <p>PM10: {todayDust.pm10Value} Âµg/mÂ³</p>

                    {/* ë°°ê²½ìƒ‰ ë° í‘œì • ê°•ì¡° */}
                    <div
                                    style={{
                                        padding: "10px",
                                        marginTop: "10px",
                                        color: "black",
                                        textAlign: "center",
                                        backgroundColor:
                                            todayDust.pm10Value <= 30
                                                ? "green"
                                                : todayDust.pm10Value <= 80
                                                ? "khaki"
                                                : todayDust.pm10Value <= 150
                                                ? "orangered"
                                                : "red",
                                    }}
                                >
                                    {todayDust.pm10Value <= 30 && (
                                        <>
                                            <p className='current-emoji'>ğŸ˜Š</p>
                                            í˜„ì¬ {city} {region} ê³µê¸°ê°€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤! <br />
                                            ì™¸ì¶œ ë° ìš´ë™ì— ì í•©í•œ ë‚ ì…ë‹ˆë‹¤!
                                        </>
                                    )}
                                    {todayDust.pm10Value > 30 && todayDust.pm10Value <= 80 && (
                                        <>
                                            <p className='current-emoji'>ğŸ˜</p>
                                            í˜„ì¬ {city} {region} ê³µê¸°ê°€ ë³´í†µì…ë‹ˆë‹¤.<br />
                                            íŠ¹ë³„í•œ ì£¼ì˜ê°€ í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ, ë¯¼ê°í•œ ì‚¬ëŒì€ ì£¼ìœ„ê°€ í•„ìš”í•©ë‹ˆë‹¤!
                                        </>
                                    )}
                                    {todayDust.pm10Value > 80 && todayDust.pm10Value <= 150 && (
                                        <>
                                            <p className='current-emoji'>ğŸ˜·</p>
                                            í˜„ì¬ {city} {region} ê³µê¸°ê°€ ë‚˜ì¨ ìƒíƒœì…ë‹ˆë‹¤.<br />
                                            ì™¸ì¶œ ìì œ ë° ì‹¤ì™¸ í™œë™ì„ ì¤„ì´ê³ , íŠ¹íˆ ë¯¼ê°í•œ ì‚¬ëŒì€ ì‹¤ë‚´ì—ì„¸ ëŒ€ê¸°í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤!
                                        </>
                                    )}
                                    {todayDust.pm10Value > 150 && (
                                        <>
                                            <p className='current-emoji'>ğŸ˜¡</p>
                                            í˜„ì¬ {city} {region}ì˜ ê³µê¸°ê°€ ë§¤ìš° ë‚˜ì¨ ìƒíƒœì…ë‹ˆë‹¤.<br />
                                            ê°€ê¸‰ì  ì™¸ì¶œì„ ì‚¼ê°€ê³ , ì‹¤ë‚´ì—ì„œ í™œë™í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤!
                                        </>
                                    )}
                                </div>
                </div>
            )}
        </div>
    );
};

export default UserNowData;